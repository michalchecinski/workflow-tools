---
- name: Check for bootstrap-apps chart
  shell:
    cmd: argocd app list | grep bootstrap-apps | wc -l
  register: argo_apps_installed

- name: Deploy ArgoCD Applications
  when: argo_apps_installed.stdout == "0"
  shell:
    cmd: |
      argocd app create bootstrap-apps \
      --dest-namespace argocd \
      --dest-server https://kubernetes.default.svc \
      --repo git@github.com:joseph-flinn/workflow-tools.git \
      --path 'homelab/apps/bootstrap-apps' \
      --grpc-web

- name: Sync ArgoCD Applications
  when: argo_apps_installed.stdout == "0"
  shell:
    cmd: argocd app sync apps
